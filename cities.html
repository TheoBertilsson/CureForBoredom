<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avancera Cities</title>
    <meta name="description" content="Tasks for grade with the Cities API" />
    <link rel="stylesheet" href="index.css" />
  </head>
  <body id="bodyCities">
    <header id="headerCities">
      <a href="index.html" class="homebtn"
        ><img src="exit-2.png" alt="Peron Exiting Door"
      /></a>
      <h1>The Cities of Avancera!</h1>
    </header>
    <main id="mainCities">
      <section id="addShowremoveSection">
        <h2>Add, Show or Remove the cities!</h2>
        <div>
          <span>What city do you wanna show?</span>
          <input type="text" placeholder="City Name" id="userCityName" />
          <input type="text" placeholder="City Population" id="userCityPop" />
          <button id="showButton">Show ALL</button>
        </div>
        <div>
          <span>Update Chosen City</span>
          <input type="text" id="userUpdateCity" placeholder="City Name" />
          <input
            type="text"
            placeholder="City Population"
            id="userUpdateCityPop"
          />
          <button id="updateButton">Update</button>
        </div>
        <div>
          <span>Add a City</span>
          <input type="text" placeholder="City Name" id="userAddedCityName" />
          <input
            type="text"
            placeholder="City Population"
            id="userAddedCityPop"
          />
          <button id="addButton">Add</button>
        </div>
        <div>
          <span>Remove a City</span>
          <input type="text" placeholder="City Name" id="userRemoveCityName" />
          <input
            type="text"
            placeholder="City Population"
            id="userRemoveCityPop"
          />
          <button id="removeButton">Remove</button>
        </div>
      </section>
      <section id="outputCities">
        <div id="outputCityDiv">
          <h2>Cities</h2>
          <ul id="list"></ul>
        </div>
        <div id="citiesReset">
          <button id="resetBtnCity">
            <img src="/reset.png" alt="Reset symbol" />
          </button>
        </div>
      </section>
    </main>

    <script>
      let userShowCityName = document.getElementById("userCityName"),
        userShowCityPop = document.getElementById("userCityPop"),
        userUpdateCityName = document.getElementById("userUpdateCity"),
        userUpdateCityPop = document.getElementById("userUpdateCityPop"),
        userAddedCityName = document.getElementById("userAddedCityName"),
        userAddedCityPop = document.getElementById("userAddedCityPop"),
        userRemoveCityName = document.getElementById("userRemoveCityName"),
        userRemoveCityPop = document.getElementById("userRemoveCityPop"),
        showButton = document.getElementById("showButton"),
        updateButton = document.getElementById("updateButton"),
        addButton = document.getElementById("addButton"),
        removeButton = document.getElementById("removeButton"),
        list = document.getElementById("list"),
        br = document.createElement("br"),
        showCityName = "",
        showCityPop,
        updateCityName,
        updateCityPop,
        addCityName,
        addCityPop,
        removeCityName,
        removeCityPop,
        id;

      //  SHOW BUTTON PRESSED

      function userPressedShow() {
        showCityName = document.getElementById("userCityName").value;
        showCityPop = document.getElementById("userCityPop").value;
        if (showCityName.length === 0 && showCityPop.length === 0) {
          showAllCities();
        } else if (showCityName.length > 0 && showCityPop.length === 0) {
          showCitiesBasedOnName();
        } else if (showCityName.length === 0 && showCityPop.length > 0) {
          showCitiesBasedOnPop();
        } else if (showCityName.length > 0 && showCityPop.length > 0) {
          showCitiesBasedOnBoth();
        } else {
          let li = document.createElement("li");
          li.appendChild(document.createTextNode("Error, no values inserted"));
          list.appendChild(li);
        }
      }

      function showAllCities() {
        fetch("https://avancera.app/cities/")
          .then((response) => response.json())
          .then((result) => {
            let i = 0;
            while (i < result.length) {
              let li = document.createElement("li");
              li.appendChild(
                document.createTextNode(
                  "City: " +
                    result[i].name +
                    " " +
                    " Population: " +
                    result[i].population
                )
              );
              list.appendChild(li);
              i++;
            }
          });
      }
      function showCitiesBasedOnName() {
        fetch("https://avancera.app/cities/?name=" + showCityName)
          .then((response) => response.json())
          .then((result) => {
            if (result.length > 0) {
              let li = document.createElement("li");
              li.appendChild(
                document.createTextNode(
                  "City: " +
                    result[0].name +
                    " " +
                    " Population: " +
                    result[0].population
                )
              );
              list.appendChild(li);
              userUpdateCityName.value = result[0].name;
              userUpdateCityPop.value = result[0].population;
              id = result[0].id;
            } else {
              let li = document.createElement("li");
              li.appendChild(document.createTextNode("No City with this name"));
              list.appendChild(li);
            }
          });
      }
      function showCitiesBasedOnPop() {
        fetch("https://avancera.app/cities/?minPopulation=" + showCityPop)
          .then((response) => response.json())
          .then((result) => {
            if (result.length > 0) {
              let i = 0;
              while (i < result.length) {
                let li = document.createElement("li");
                li.appendChild(
                  document.createTextNode(
                    "City: " +
                      result[i].name +
                      " " +
                      " Population: " +
                      result[i].population
                  )
                );
                list.appendChild(li);
                i++;
              }
              if (result.length === 1) {
                userUpdateCityName.value = result[0].name;
                userUpdateCityPop.value = result[0].population;
                id = result[0].id;
              }
            } else {
              let li = document.createElement("li");
              li.appendChild(
                document.createTextNode("No City with such a big population")
              );
              list.appendChild(li);
            }
          });
      }
      function showCitiesBasedOnBoth() {
        fetch(
          "https://avancera.app/cities/?name=" +
            showCityName +
            "&minPopulation=" +
            showCityPop
        )
          .then((response) => response.json())
          .then((result) => {
            if (result.length > 0) {
              let li = document.createElement("li");
              li.appendChild(
                document.createTextNode(
                  "City: " +
                    result[0].name +
                    " " +
                    " Population: " +
                    result[0].population
                )
              );
              list.appendChild(li);
              userUpdateCityName.value = result[0].name;
              userUpdateCityPop.value = result[0].population;
              id = result[0].id;
            } else {
              let li = document.createElement("li");
              li.appendChild(document.createTextNode("No City with this name or such a big population"));
              list.appendChild(li);
            }
          });
      }

      // UPDATE BUTTON PRESSED
      function userPressedUpdate() {
        updateCityName = document.getElementById("userUpdateCity").value;
        updateCityPop = document.getElementById("userUpdateCityPop").value;

        if (updateCityName.length > 0 && updateCityPop.length > 0) {
          fetch("https://avancera.app/cities/" + id, {
            body:
              '{ "id" : "' +
              id +
              '", "name" : "' +
              updateCityName +
              '", "population":' +
              updateCityPop +
              "}",
            headers: {
              "Content-type": "application/json",
            },
            method: "PUT",
          });
          let li = document.createElement("li");
          li.appendChild(
            document.createTextNode(
              "City: " + updateCityName + " " + " Population: " + updateCityPop
            )
          );
          list.appendChild(li);
        } else if (updateCityName.length === 0 && updateCityPop.length > 0) {
          let li = document.createElement("li");
          li.appendChild(
            document.createTextNode("Error, no name value inserted")
          );
          list.appendChild(li);
        } else if (updateCityName.length > 0 && updateCityPop.length === 0) {
          let li = document.createElement("li");
          li.appendChild(
            document.createTextNode("Error, no Population value inserted")
          );
          list.appendChild(li);
        }
      }

      //  ADD BUTTON PRESSED
      function userPressedAdd() {
        addCityName = document.getElementById("userAddedCityName").value;
        addCityPop = document.getElementById("userAddedCityPop").value;

        fetch("https://avancera.app/cities/", {
          body:
            '{ "name" : "' +
            addCityName +
            '", "population":' +
            addCityPop +
            "}",
          headers: {
            "Content-type": "application/json",
          },
          method: "POST",
        });
        userUpdateCityName.value = addCityName;
        userUpdateCityPop.value = addCityPop;
        let li = document.createElement("li");
        li.appendChild(
          document.createTextNode(
            "City: " + addCityName + " " + " Population: " + addCityPop
          )
        );
        list.appendChild(li);
      }

      // REMOVE BUTTON PRESSED
      function userPressedRemove() {
        removeCityName = document.getElementById("userRemoveCityName").value;
        removeCityPop = document.getElementById("userRemoveCityPop").value;
        if (removeCityName.length > 0 && removeCityPop.length > 0) {
          removeBasedOnBoth();
        } else if (removeCityName.length > 0 && removeCityPop.length === 0) {
          removeBasedOnName();
        } else if (removeCityName.length === 0 && removeCityPop) {
          let li = document.createElement("li");
          li.appendChild(
            document.createTextNode("Error, no name value inserted")
          );
          list.appendChild(li);
        } else {
          let li = document.createElement("li");
          li.appendChild(document.createTextNode("Error, no values inserted"));
          list.appendChild(li);
        }
      }

      function removeBasedOnBoth() {
        fetch(
          "https://avancera.app/cities/?name=" +
            removeCityName +
            "&minPopulation=" +
            removeCityPop
        )
          .then((response) => response.json())
          .then((result) => {
            id = result[0].id;
          });
        fetch("https://avancera.app/cities/" + id, {
          method: "DELETE",
        });
        let li = document.createElement("li");
        li.appendChild(
          document.createTextNode(
            "The City " + removeCityName + " has been remove"
          )
        );
        list.appendChild(li);
      }
      function removeBasedOnName() {
        fetch("https://avancera.app/cities/?name=" + removeCityName)
          .then((response) => response.json())
          .then((result) => {
            id = result[0].id;
          });
        fetch("https://avancera.app/cities/" + id, {
          method: "DELETE",
        });
        let li = document.createElement("li");
        li.appendChild(
          document.createTextNode(
            "The City " + removeCityName + " has been remove"
          )
        );
        list.appendChild(li);
      }

      // CHANGE SHOW BUTTON TEXT
      function changebutton() {
        showCityName = document.getElementById("userCityName").value;
        showCityPop = document.getElementById("userCityPop").value;

        if (showCityName.length > 0 || showCityPop.length > 0) {
          showButton.innerHTML = "Show";
        } else {
          showButton.innerHTML = "Show ALL";
        }
      }
      // Event Listeners
      showButton.addEventListener("click", userPressedShow);
      updateButton.addEventListener("click", userPressedUpdate);
      addButton.addEventListener("click", userPressedAdd);
      removeButton.addEventListener("click", userPressedRemove);
      userShowCityName.addEventListener("change", changebutton);
      userShowCityPop.addEventListener("change", changebutton);
    </script>
  </body>
</html>
